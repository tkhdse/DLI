package main

import (
	"context"
	"dli/internal/config"
	"dli/internal/vdb"
	"fmt"
	"log"
	"time"
)

func main() {
	cfg, err := config.Load()
	if err != nil {
		log.Fatalf("Failed to load config: %v", err)
	}

	// Create Pinecone client
	client, err := vdb.NewClient(cfg.PineconeAPIKey, cfg.PineconeIndex)
	if err != nil {
		log.Fatalf("Failed to create Pinecone client: %v", err)
	}

	ctx, cancel := context.WithTimeout(context.Background(), 60*time.Second)
	defer cancel()

	// Example 1: Simple query with a vector
	fmt.Println("=== Simple Query ===")

	// Create a query vector (replace with your actual vector dimensions)
	queryVector := []float32{-0.0692919418, 0.0567390621, -0.0122783622, -0.041580122, -0.0411432236, 0.0325583406, 0.0467632078, 0.0236557294, -0.110113524, -0.0140392417, 0.0471556261, 0.0865878314, 0.13027817, 0.0353354774, -0.0207599178, -0.00969603751, -0.00103605096, -0.00779606123, -0.0935834125, -0.0200348012, -0.078169629, 0.000469797058, 0.0968476683, 0.0492567085, 0.0214952659, 0.0111181242, -0.0297234692, 0.0325546786, -0.090980716, 0.0148530975, 0.0515451729, -0.0482295603, -0.0357646085, -0.000905892171, 0.00831430499, -0.0145199783, -0.0365558937, 0.0593678616, 0.0677842349, 0.022230221, -0.0762714595, -0.0542420968, 0.0105914045, 0.0262306985, -0.0196746569, 0.0189321209, 0.040990252, -0.0713927224, -0.00572516164, -0.035708826, -0.0368389413, 0.018070288, -0.027438879, -0.0317541622, 0.0838007852, 0.0443112813, 0.00736152148, 0.0544034839, -0.0195904113, -0.143121704, -0.0561569221, -0.0316458084, 0.0364501849, 0.0234584417, -0.151680231, -0.0349436142, 0.0474141575, -0.0164340902, 0.0100452388, -0.00257673603, 0.0185925253, 0.0504743233, -0.0362223573, -0.0228041448, 0.0160300769, 0.0000703188, 0.047952991, 0.0363571681, 0.0890351459, -0.0625946, 0.0644153059, 0.08037135, 0.00904766284, -0.00405528024, -0.0274021085, -0.0461909, 0.00408537872, -0.0150047364, 0.0447154082, -0.0428993031, 0.0536256284, -0.0329483971, -0.0605216399, 0.00303340075, -0.0458798334, 0.00647415314, 0.0510655679, 0.0533451512, -0.056005422, 0.00503761, 0.0968198106, -0.05624336, -0.0733114704, -0.0507115945, -0.0194268581, -0.0251774732, 0.0780029595, 0.0193520579, -0.100533009, -0.0360833034, 0.0127712348, -0.0375157967, -0.00316586811, -0.0170012042, 0.0176553931, 0.113679707, -0.0543871224, 0.00159459386, -0.080195643, 0.0624285415, -0.0250433348, -0.103370927, 0.00809755735, 0.0412657633, -0.0158786196, 0.11666026, 0.000822433445, 5.79266489e-34, -0.0159439333, -0.110757783, -0.0694703907, 0.124189407, 0.0150401872, 0.0386188962, 0.00134299253, -0.0839133635, 0.0418151245, -0.056994278, 0.0340315923, 0.0185843017, -0.0124294274, -0.00824492797, -0.116985746, -0.0446563438, -0.015024907, 0.114369303, 0.0180861633, -0.0378368273, -0.00188687653, -0.0160124023, 0.00451382576, -0.0716278479, 0.088141337, -0.0126085784, 0.0219860673, 0.0130043747, 0.0628528446, 0.0471191928, -0.0297522116, -0.0269469265, -0.0620411299, 0.00644776179, 0.0218479428, -0.0558379255, -0.0544926301, -0.0338312238, 0.0559089966, 0.00903001148, 0.0324360058, 0.0892425627, -0.00936065149, 0.015743183, 0.0502353236, 0.0269087423, 0.00523268571, 0.080037877, -0.020938905, -0.0732271448, -0.034681242, -0.00212655636, 0.0195201542, -0.0438911207, 0.0130293379, 0.0368286818, -0.000835652812, 0.0164778773, -0.0407158621, -0.0471113808, -0.0157921705, 0.0926122293, -0.0840812176, 0.00420023547, 0.0808562785, -0.0357886888, -0.143018365, 0.0487386361, 0.00316143036, 0.012928579, 0.0814073533, -0.0718373358, -0.0360566527, -0.046841193, -0.00368425017, -0.0225384906, 0.0287950784, 0.0238230526, -0.0340511, -0.095117189, -0.056757424, 0.0654771477, -0.0346430652, 0.0934186205, -0.0282268152, -0.0826819167, -0.000562606729, -0.029695401, -0.00732356217, 0.0229406487, -0.0429560095, -0.0681666508, -0.0446744449, -0.0562750921, -0.00997776, -2.94321727e-33, -0.000580965774, 0.133282959, 0.040340364, -0.0308080148, 0.11016681, -0.00737157324, 0.0062256027, -0.0363496579, 0.0501135774, -0.0320317559, 0.00468898052, 0.0167213622, -0.0817348137, -0.00382997561, -0.04680866, -0.00817978662, -0.0330964141, -0.0543618165, -0.0153291337, 0.0466816276, 0.0245733298, -0.117136255, -0.0489148237, 0.0643857718, 0.00237182085, 0.0316094868, -0.00620625727, 0.0108720371, 0.0431521758, 0.00351118925, 0.100679994, -0.0393202417, 0.0245968588, 0.0135053443, 0.0515963, 0.0402154662, 0.0208085719, -0.0137042869, -0.101651259, 0.0147254262, 0.0855672956, -0.0533558093, 0.0771388486, -0.0288590286, -0.0175350215, -0.0313847587, -0.044804994, -0.0566679761, -0.0506336167, -0.031983465, -0.0908109769, -0.0366487466, 0.00373757468, -0.00377758173, 0.0431067795, 0.0453835614, 0.0144994929, 0.0490385443, -0.00968630891, 0.00190890371, 0.0178164039, 0.0174919497, 0.0171476547, 0.0177924428, -0.0893718898, 0.0004608538, -0.0430473313, -0.0310188085, -0.0469965711, 0.0318629257, 0.0385603607, -0.0284574348, -0.00459543848, -0.0419488437, 0.0321885, -0.00379281188, -0.10304077, -0.0327047817, -0.0175553, 0.0272010472, -0.0114454692, -0.0247337148, -0.0596319176, 0.00127974816, -0.127175599, 0.0120697804, 0.0189611167, -0.0272241719, -0.00700264471, -0.0866044164, 0.0642778203, -0.0978310257, -0.0124930032, 0.0813727155, -0.0323659591, -4.3669619e-8, -0.009718257, 0.0690422356, 0.0712764338, 0.118497059, -0.0632654652, -0.0512952209, 0.0145598901, -0.00981810596, 0.0437164195, 0.032095056, -0.025429232, -0.0175587647, 0.105178095, -0.0245083235, 0.0421521217, -0.0440951809, -0.00330285402, -0.0806349069, -0.0177731123, 0.0215763543, 0.0426587202, -0.0222427547, -0.065324612, 0.0150798475, 0.00706938701, 0.076405175, -0.00260405499, 0.00204688217, 0.0247212499, 0.0502388068, 0.09368442, -0.0123618459, -0.0357023329, 0.056001991, 0.0857953951, -0.0143358326, -0.0123827644, -0.0533406548, 0.0232935976, 0.0283149779, -0.0392998159, 0.0609887801, 0.0790896565, 0.0281761196, 0.100668594, 0.0909290463, 0.0343919657, -0.0270391293, -0.0721998438, 0.0114324102, 0.0264881589, 0.0401545, 0.0240149386, 0.0128782345, -0.011205459, 0.097138606, 0.0499740653, -0.022948239, -0.029182611, 0.013517498, -0.0448462702, 0.00366790802, -0.0240459014, 0.0166908018} // Example vector:

	// Build the query request
	queryReq := vdb.QueryRequest{
		Vector:          queryVector,
		TopK:            5,     // Get top 5 similar vectors
		IncludeMetadata: true,  // Include metadata in results
		IncludeValues:   false, // Don't include vector values in results (saves bandwidth)
	}

	// Execute the query
	results, err := client.Query(ctx, queryReq)
	if err != nil {
		log.Fatalf("Failed to query: %v", err)
	}

	// Print results
	fmt.Printf("Found %d matches:\n", len(results.Matches))
	for i, match := range results.Matches {
		fmt.Printf("\nMatch %d:\n", i+1)
		fmt.Printf("  ID: %s\n", match.ID)
		fmt.Printf("  Score: %.4f\n", match.Score)
		fmt.Printf("  Metadata: %+v\n", match.Metadata)
	}

}
